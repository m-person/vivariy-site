function popup(a,b){var c=b||"error";c="alert-"+c,$("body").append('<div id="alert-popup" class="alert '+c+' alert-dismissible fade in" role="alert">                      <button type="button" class="close" data-dismiss="alert" aria-label="Close">                      <span aria-hidden="true">&times;</span></button>'+a+"</div>"),setTimeout(function(){$("#alert-popup").remove()},5e3)}function addToCart(a){a.preventDefault(),$.post(window.location.pathname,{},function(b){"ok"!=b.result?popup("\u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u0437\u0430\u043f\u0440\u043e\u0441.","error"):(update_cart(),$(a.target).addClass("disabled"))}).fail(function(){popup("\u041e\u0448\u0438\u0431\u043a\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u0437\u0430\u043f\u0440\u043e\u0441.","error")})}function delFromCart(a){a.preventDefault();var b=$(this);$.ajax({url:"/products/"+b.data("slug"),method:"DELETE",success:function(a){if("ok"!=a.result)return void popup("\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0442\u043e\u0432\u0430\u0440\u0430 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430.","error");if(b.parents("li.cart-item").remove(),!$(".cart-placeholder .cart-item").length){var e=$(".cart-placeholder");e.empty(),e.append('<div class="cart-empty-msg">\u0421\u043f\u0438\u0441\u043e\u043a \u043f\u0443\u0441\u0442.<br>\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0432\u0430\u0440 \u043a \u0437\u0430\u043f\u0440\u043e\u0441\u0443 \u043c\u043e\u0436\u043d\u043e \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u0442\u043e\u0432\u0430\u0440\u0430 \u0432 \u043a\u0430\u0442\u0430\u043b\u043e\u0433\u0435.</div>')}update_cart()},error:function(){popup("\u041e\u0448\u0438\u0431\u043a\u0430 \u0443\u0434\u0430\u043b\u0435\u043d\u0438\u044f \u0442\u043e\u0432\u0430\u0440\u0430 \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430.","error")}})}function getCookie(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function setMainBlockHeight(){var a=$("footer").outerHeight(),b=$("header").outerHeight(),c=$(window).height(),d=$("main"),e=c-a-b;d.css("minHeight",e),updateMainChildrenHeight()}function updateMainChildrenHeight(){var a=$("main").height(),b=$(".article-tags-panel"),c=$(".contacts-page div.contacts");$(window).width()>=992?(c.height(a),$(".aside-bkg").height(a),b.height(a)):($(".aside-bkg").height(0),b.length&&b.height(b.find("div")[0].scrollHeight+300),c.length&&c.height(c.find("div")[0].scrollHeight+60)),$(window).width()>=768&&$(".catalog-aside").height(a)}function setSideBkgWidth(){var a=$(".aside-bkg");if(a.length){if($(window).width()<992)return void a.width(0);if(location.pathname.indexOf("/catalog/")>=0){var b=$(".catalog-aside");a.width(b.offset().left+10)}if(location.pathname.indexOf("/articles/")>=0){var c=$(".article-tags-panel");a.width(window.innerWidth-c.offset().left-40)}location.pathname.indexOf("/contacts/")>=0&&a.width(window.innerWidth/2-20)}}function categoryPanelShow(){var a=$(this).attr("id");Cookies.set("current_category",a),$(".catalog-category .collapse").collapse("hide"),$(this).find(".glyphicon").removeClass("glyphicon-plus-sign").addClass("glyphicon-minus-sign"),$(this).parents().find(".panel-heading h3").removeClass("active"),$(this).find(".panel-heading h3").addClass("active")}function categoryPanelHide(){var a=$(this).attr("id");a==Cookies.get("current_category")&&Cookies.set("current_category",null),$(this).find(".glyphicon").removeClass("glyphicon-minus-sign").addClass("glyphicon-plus-sign"),$(this).find(".panel-heading h3").removeClass("active"),$(this).parents().find(".panel-heading h3").removeClass("active")}function expandCurrentCategory(){if(-1!=location.pathname.indexOf("/catalog/")){var a=Cookies.get("current_category"),b=$("#"+a);b&&b.find(".collapse").collapse("show")}}function update_cart(){var a=$(".request-basket-btn"),b=a.find("span:last-of-type");$.get("/xhr/cart_count/",function(c){0==c?a.addClass("hidden"):(a.removeClass("hidden"),b.html(c))})}$(document).ready(function(){var a=$("#product-gallery");a.length&&a.lightSlider({gallery:!0,item:1,loop:!0,thumbItem:5,slideMargin:1,enableDrag:!0,currentPagerPosition:"left",slideMove:1,useCSS:!0,mode:"slide",controls:!0,galleryMargin:1,thumbMargin:1});var b=getCookie("csrftoken");$.ajaxSetup({beforeSend:function(a,c){csrfSafeMethod(c.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",b)}});var c=$(".catalog-category .panel");c.on("shown.bs.collapse",updateMainChildrenHeight),c.on("show.bs.collapse",categoryPanelShow),c.on("hide.bs.collapse",categoryPanelHide),$(".product-ask-btn").on("click",addToCart),$(".cart-item-remove-btn").on("click",delFromCart),expandCurrentCategory()}),$(window).load(function(){setMainBlockHeight(),setSideBkgWidth(),$(window).resize(setMainBlockHeight),$(window).resize(setSideBkgWidth)});